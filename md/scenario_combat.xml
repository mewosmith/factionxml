<?xml version="1.0" encoding="utf-8"?>
<mdscript name="Scenario_combat" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
  <cues>

    <cue name="X4ep1_Gamestart_Tutorial1" module="x4ep1_gamestart_tutorial1">
      <conditions>
        <event_cue_signalled cue="md.Setup.GameStart" />
      </conditions>
      <actions>
        <debug_text text="'Setup for X4ep1_Gamestart_Tutorial1'"/>
        <set_value name="$UseCaseDebugChance" exact="0"/>
        <set_value name="md.$TutorialActive" exact="true" comment="silence global hints"/>
        <set_value name="md.$SurpressTutorials" exact="true" comment="surpress tutorials"/>
        <set_value name="$AlliedFaction" exact="faction.argon"/>
        <set_value name="$EnemyFaction" exact="faction.xenon"/>
        <set_value name="$AlliedDestroyerMacro" exact="macro.ship_arg_l_destroyer_01_a_macro"/>
        <set_value name="$AlliedDestroyerCaptainMacro" exact="macro.character_scenario_combat_arg_captain_macro"/>
        <set_value name="$AlliedDestroyerNavigationMacro" exact="macro.character_scenario_combat_arg_navigation_macro"/>
        <set_value name="$AlliedDestroyerHelmMacro" exact="macro.character_scenario_combat_arg_helm_macro"/>
        <set_value name="$AlliedDestroyerGunnerMacro" exact="macro.character_scenario_combat_arg_gunner_macro"/>
        <set_value name="$AlliedDestroyerMarineMacro" exact="macro.character_scenario_combat_arg_marine_macro"/>
        <set_value name="$AlliedCarrierMacro" exact="macro.ship_arg_xl_carrier_01_a_macro"/>
        <set_value name="$AlliedBomberMacro" exact="macro.ship_arg_m_bomber_01_b_macro"/>
        <set_value name="$AlliedCarrierCaptainMacro" exact="macro.tutorial_character_commander_macro"/>
        <set_value name="$AlliedCrew" exact="'argon_military_crew'"/>
        <set_value name="$PlayerFighterMacro1" exact="macro.ship_arg_s_heavyfighter_02_a_macro"/>
        <set_value name="$PlayerFighterMacro2" exact="macro.ship_arg_s_fighter_01_a_macro"/>
        <set_value name="$PlayerFighterPaintMod" exact="ware.paintmod_0002"/>
        <set_value name="$EnemyMinerMacro" exact="macro.ship_xen_m_miner_01_a_macro"/>
        <set_value name="$EnemySquadLeaderMacro" exact="macro.ship_xen_m_fighter_01_a_macro"/>
        <set_value name="$EnemySquadWingmanMacro" exact="macro.ship_xen_s_fighter_01_a_macro"/>
        <set_value name="$EnemyDestroyerMacro" exact="macro.ship_xen_xl_destroyer_01_a_macro" comment="ship_xen_xl_carrier_01_a_macro"/>
        <set_value name="$DefenceDroneMacro" exact="macro.ship_gen_s_fightingdrone_01_a_macro"/>
        <set_value name="$PlayerAttackerMacro" exact="macro.ship_xen_s_fighter_01_a_macro"/>
        <set_faction_relation faction="$AlliedFaction" otherfaction="faction.player" value="$AlliedFaction.relation.ally.min" />
        <set_faction_relation faction="$EnemyFaction" otherfaction="faction.player" value="$EnemyFaction.relation.kill.max" />
        <set_faction_relation faction="$AlliedFaction" otherfaction="$EnemyFaction" value="$EnemyFaction.relation.kill.max" />
        <set_faction_relation faction="$EnemyFaction" otherfaction="$AlliedFaction" value="$EnemyFaction.relation.kill.max" />
        <set_faction_relation_locked faction="faction.player" locked="true" />
        <set_faction_relation_locked faction="$AlliedFaction" locked="true" />
        <set_faction_relation_locked faction="$EnemyFaction" locked="true" />
        <!-- create groups (initially empty)-->
        <create_group groupname="$PlayerFighterGroup"/>
        <create_group groupname="$PlayerWeaponsGroup"/>
        <create_group groupname="$EnemyMinerGroup"/>
        <create_group groupname="$EnemySquadGroup"/>
        <create_group groupname="$EnemyDestroyerGroup"/>
        <create_group groupname="$EnemyDefenceDroneGroup"/>
        <create_group groupname="$AlliedBomberGroup"/>
        <create_group groupname="$AlliedDestroyerMarineGroup"/>
        <create_group groupname="$PlayerAttackerGroup"/>
      </actions>
      <cues>
        <cue name="Tutorial_Player_Undocked" instantiate="true">
          <conditions>
            <event_object_undocked group="$PlayerFighterGroup"/>
            <check_value value="player.controlled == event.object"/>
          </conditions>
          <delay exact="1s" />
          <actions>
            <do_if value="not $FlightHintsDisplayed?">
              <remove_help all="true"/>
              <!--<cancel_cue cue="Scenario1_SelectShip"/>-->
              <debug_text text="'Signalling Tutorial_Player_MoveShip'" />
              <signal_cue cue="Tutorial_Player_MoveShip"/>
              <set_value name="$FlightHintsDisplayed" exact="true"/>
            </do_if>
          </actions>
          <cues>
            <cue name="Tutorial_Player_MoveShip_Early_Check" checkinterval="0.5s">
              <conditions>
                <check_value value="player.input.flight.throttle != 0"/>
              </conditions>
              <actions>
                <set_value name="$Tutorial_MoveShip_Unnecessary" exact="true"/>
              </actions>
            </cue>

            <cue name="Tutorial_Player_SteerShip_Early_Check" checkinterval="0.5s">
              <conditions>
                <check_value value="player.input.flight.yaw != 0 or player.input.flight.pitch != 0 or player.input.flight.roll != 0"/>
              </conditions>
              <actions>
                <set_value name="$Tutorial_SteerShip_Unnecessary" exact="true"/>
              </actions>
            </cue>

            <cue name="Tutorial_Player_StrafeShip_Early_Check" checkinterval="0.5s">
              <conditions>
                <check_value value="player.input.flight.horizontal != 0 or player.input.flight.vertical != 0"/>
              </conditions>
              <actions>
                <set_value name="$Tutorial_StrafeShip_Unnecessary" exact="true"/>
              </actions>
            </cue>

            <cue name="Tutorial_Player_Select_Early_Check">
              <conditions>
                <event_player_changed_target/>
              </conditions>
              <actions>
                <set_value name="$Tutorial_Select_Unnecessary" exact="true"/>
              </actions>
            </cue>

            <cue name="Tutorial_Player_Shoot_Early_Check">
              <conditions>
                <event_weapon_fired group="$PlayerWeaponsGroup"/>
              </conditions>
              <actions>
                <set_value name="$Tutorial_Shoot_Unnecessary" exact="true"/>
              </actions>
            </cue>

            <cue name="Tutorial_Player_MoveShip">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <do_if value="$Tutorial_MoveShip_Unnecessary?">
                  <remove_help all="true"/>
                  <cancel_cue cue="Tutorial_Player_MoveShip_Finished"/>
                  <debug_text text="'Signalling Tutorial_Player_SteerShip'" />
                  <signal_cue cue="Tutorial_Player_SteerShip"/>
                </do_if>
                <do_else>
                  <do_if value="player.input.controller or player.input.oculustouch">
                    <show_help line="2010" log="true" timeout="false" position="1" force="true" comment="Use $INPUT_RANGE_THROTTLE$ to accelerate and $INPUT_STATE_FULLREVERSE$ to decelerate"/>
                  </do_if>
                  <do_elseif value="player.input.vivecontroller">
                    <show_help line="4110" log="true" timeout="false" position="1" force="true" comment="To accelerate, hold the left trigger until you feel resistance. Use $INPUT_STATE_FULLREVERSE$ to decelerate and reverse." />
                  </do_elseif>
                  <do_else>
                    <show_help line="2011" log="true" timeout="false" position="1" force="true" comment="Press $INPUT_STATE_ACCELERATE$ to accelerate and $INPUT_STATE_DECELERATE$ to decelerate"/>
                  </do_else>
                </do_else>
              </actions>
              <cues>
                <cue name="Tutorial_Player_MoveShip_Finished" checkinterval="0.5s">
                  <conditions>
                    <check_value value="player.input.flight.throttle != 0"/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <remove_help all="true"/>
                    <debug_text text="'Signalling Tutorial_Player_SteerShip'" />
                    <signal_cue cue="Tutorial_Player_SteerShip"/>
                  </actions>
                </cue>
              </cues>
            </cue>
            <cue name="Tutorial_Player_SteerShip">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <do_if value="$Tutorial_SteerShip_Unnecessary?">
                  <remove_help all="true"/>
                  <cancel_cue cue="Tutorial_Player_SteerShip_Finished"/>
                  <!--skipping over 'strafe ship' on purpose here - TODO @Matthias: re-enable it in a better location, like when attacking turrets (not required for the Gamescom demo)-->
                  <do_if value="player.input.controller">
                    <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                    <signal_cue cue="Tutorial_Player_Shoot"/>
                  </do_if>
                  <do_else>
                    <debug_text text="'Signalling Tutorial_Player_Select'" />
                    <signal_cue cue="Tutorial_Player_Select"/>
                  </do_else>
                </do_if>
                <do_else>
                  <do_if value="not player.isvrmode and not player.input.controller and not player.input.vrcontroller">
                    <show_help line="2005" log="true" timeout="false" position="1" force="true" comment="Press '$INPUT_ACTION_TOGGLEMOUSESTEERING$' to enable/disable cursor steering. You will fly towards your mouse cursor."/>
                  </do_if>
                  <do_elseif value="player.input.controller or player.input.oculustouch">
                    <show_help line="2002" log="true" timeout="false" position="1" force="true" comment="Use Right Stick to steer and Left Stick to strafe."/>
                  </do_elseif>
                  <do_elseif value="player.input.vivecontroller">
                    <show_help line="4109" log="true" timeout="false" position="1" force="true" comment="The Vive Controller Trackpads measure the movement of your thumbs across their surface." />
                  </do_elseif>
                  <do_else>
                    <debug_text text="'Player is playing with keyboard in VR - show keyboard steering controls'" chance="$DebugChance" />
                    <show_help line="4117" log="true" timeout="false" position="1" force="true" comment="Use $INPUT_STATE_STEER_DOWN$, $INPUT_STATE_STEER_UP$, $INPUT_STATE_STEER_LEFT$, $INPUT_STATE_STEER_RIGHT$ to steer." />
                  </do_else>
                </do_else>
              </actions>
              <cues>
                <cue name="Tutorial_Player_SteerShip_Finished" checkinterval="0.5s">
                  <conditions>
                    <check_value value="player.input.flight.yaw != 0 or player.input.flight.pitch != 0 or player.input.flight.roll != 0"/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <remove_help all="true"/>
                    <!--skipping over 'strafe ship' on purpose here - TODO @Matthias: re-enable it in a better location, like when attacking turrets (not required for the Gamescom demo)-->
                    <do_if value="player.input.controller">
                      <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                      <signal_cue cue="Tutorial_Player_Shoot"/>
                    </do_if>
                    <do_else>
                      <debug_text text="'Signalling Tutorial_Player_Select'" />
                      <signal_cue cue="Tutorial_Player_Select"/>
                    </do_else>
                  </actions>
                </cue>
              </cues>
            </cue>
            <cue name="Tutorial_Player_StrafeShip">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <do_if value="$Tutorial_StrafeShip_Unnecessary?">
                  <remove_help all="true"/>
                  <cancel_cue cue="Tutorial_Player_StrafeShip_Finished"/>
                  <do_if value="player.input.controller">
                    <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                    <signal_cue cue="Tutorial_Player_Shoot"/>
                  </do_if>
                  <do_else>
                    <debug_text text="'Signalling Tutorial_Player_Select'" />
                    <signal_cue cue="Tutorial_Player_Select"/>
                  </do_else>
                </do_if>
                <do_else>
                  <do_if value="not player.isvrmode and not player.input.controller and not player.input.vrcontroller">
                    <show_help line="515" log="true" timeout="false" position="1" force="true" comment="Strafe using '$INPUT_STATE_STRAFE_UP$', '$INPUT_STATE_STRAFE_LEFT$', '$INPUT_STATE_STRAFE_DOWN$', '$INPUT_STATE_STRAFE_RIGHT$' to evade incoming fire." />
                  </do_if>
                  <do_elseif value="player.input.controller or player.input.oculustouch">
                    <show_help line="514" log="true" timeout="false" position="1" force="true" comment="Evade enemy fire by using $INPUT_RANGE_STRAFE_UP_DOWN$ to strafe vertically and $INPUT_RANGE_STRAFE_LEFT_RIGHT$ to strafe horizontally." />
                  </do_elseif>
                  <do_elseif value="player.input.vivecontroller">
                    <show_help line="4101" log="true" timeout="false" position="1" force="true" comment="Use Right Trackpad to steer and Left Trackpad to strafe." />
                  </do_elseif>
                  <do_else>
                    <show_help line="515" log="true" timeout="false" position="1" force="true" comment="Strafe using '$INPUT_STATE_STRAFE_UP$', '$INPUT_STATE_STRAFE_LEFT$', '$INPUT_STATE_STRAFE_DOWN$', '$INPUT_STATE_STRAFE_RIGHT$' to evade incoming fire." />
                  </do_else>
                </do_else>
              </actions>
              <cues>
                <cue name="Tutorial_Player_StrafeShip_Finished" checkinterval="0.5s">
                  <conditions>
                    <check_value value="player.input.flight.horizontal != 0 or player.input.flight.vertical != 0"/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <remove_help all="true"/>
                    <do_if value="player.input.controller">
                      <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                      <signal_cue cue="Tutorial_Player_Shoot"/>
                    </do_if>
                    <do_else>
                      <debug_text text="'Signalling Tutorial_Player_Select'" />
                      <signal_cue cue="Tutorial_Player_Select"/>
                    </do_else>
                  </actions>
                </cue>
              </cues>
            </cue>
            <cue name="Tutorial_Player_Select">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <do_if value="$Tutorial_Select_Unnecessary?">
                  <remove_help all="true"/>
                  <cancel_cue cue="Tutorial_Player_Select_Finished"/>
                  <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                  <signal_cue cue="Tutorial_Player_Shoot"/>
                </do_if>
                <do_else>
                  <show_help line="5220" log="true" timeout="false" position="1" force="true" comment="Objects can be selected with left clicking with the mouse."/>
                </do_else>
              </actions>
              <cues>
                <cue name="Tutorial_Player_Select_Finished">
                  <conditions>
                    <event_player_changed_target/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <remove_help all="true"/>
                    <debug_text text="'Signalling Tutorial_Player_Shoot'" />
                    <signal_cue cue="Tutorial_Player_Shoot"/>
                  </actions>
                </cue>
              </cues>
            </cue>
            <cue name="Tutorial_Player_Shoot">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <do_if value="$Tutorial_Shoot_Unnecessary?">
                  <remove_help all="true"/>
                  <cancel_cue cue="Tutorial_Player_Shoot_Finished"/>
                  <debug_text text="'Signalling Tutorial_Player_Weapon_Range'" />
                  <signal_cue cue="Tutorial_Player_Weapon_Range"/>
                </do_if>
                <do_else>
                  <do_if value="player.isvrmode">
                    <show_help line="4103" log="true" timeout="false" position="1" force="true" comment="Press $INPUT_STATE_FIRE_PRIMARY_WEAPON$. Your weapon shoots in the direction you are looking." />
                  </do_if>
                  <do_else>
                    <show_help line="2040" log="true" timeout="false" position="1" force="true" comment="Press $INPUT_STATE_FIRE_PRIMARY_WEAPON$ to shoot at your current target's predicted position."/>
                  </do_else>
                </do_else>
              </actions>
              <cues>
                <cue name="Tutorial_Player_Shoot_Finished">
                  <conditions>
                    <event_weapon_fired group="$PlayerWeaponsGroup"/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <remove_help all="true"/>
                    <debug_text text="'Signalling Tutorial_Player_Weapon_Range'" />
                    <signal_cue cue="Tutorial_Player_Weapon_Range"/>
                  </actions>
                </cue>
              </cues>
            </cue>
            <cue name="Tutorial_Player_Weapon_Range">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <substitute_text text="$WeaponRangeHintText" source="{1012,2087}">
                  <replace string="'$WEAPON_RANGE$'" with="player.ship.shortestmaxcombatrange.primary"/>
                </substitute_text>
                <show_help custom="$WeaponRangeHintText" log="true" duration="5s" position="1" force="true" comment="Your weapons have a range of $WEAPON_RANGE$m. Get close!"/>
              </actions>
            </cue>
            <cue name="Tutorial_Player_Weapon_Overheated">
              <conditions>
                <event_weapon_overheated group="$PlayerWeaponsGroup"/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <show_help line="2085" log="false" duration="7s" position="1" force="true" comment="Your weapons have overheated and cannot fire right now. They will cool down soon."/>
              </actions>
            </cue>
            <cue name="Tutorial_Player_Undocked_Voice">
              <delay exact="4s"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_player_undocked', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Helm = $AlliedDestroyerHelm ], $debugchance = $UseCaseDebugChance ]" />
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- Rescue the player if his ship was destroyed (if he has ships remaining) -->
        <cue name="Tutorial_Player_ShipDestroyed" instantiate="true">
          <conditions>
            <event_object_hull_damaged group="$PlayerFighterGroup"/>
            <check_value value="player.controlled == event.object"/>
            <check_value value="$PlayerFighterGroup.count gt 1"/>
            <check_value value="event.object.hullpercentage le 1"/>
          </conditions>
          <delay exact="1ms"/>
          <actions>
            <teleport_player object="$AlliedDestroyer" instant="true" force="true"/>
            <set_value name="this.$DestroyedShip" exact="event.object"/>
            <!--signal the retrieval cues again, the surviving ship may be in storage (these are safe to signal if their ship has been destroyed or is already on an external dock)-->
            <debug_text text="'Signalling Scenario1_RequestRetrieval_Delay1 and Scenario1_RequestRetrieval_Delay2'" />
            <signal_cue cue="Scenario1_RequestRetrieval_Delay1"/>
            <signal_cue cue="Scenario1_RequestRetrieval_Delay2"/>
          </actions>
          <cues>
            <cue name="Tutorial_Player_Emergency_Teleport_Destroy_Ship">
              <delay exact="1s"/>
              <actions>
                <destroy_object object="Tutorial_Player_ShipDestroyed.$DestroyedShip" explosion="true"/>
              </actions>
            </cue>
            <cue name="Tutorial_Player_Emergency_Teleport_Line">
              <delay exact="1s"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_player_emergency_teleport', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Computer = player.computer ], $debugchance = $UseCaseDebugChance ]" />
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- if you dock, you can select another ship, the 'next' cue (battle) should maintain its state (if it was triggered already)-->
        <cue name="Scenario1_SelectShip" instantiate="true">
          <conditions>
            <event_cue_signalled/>
          </conditions>
          <delay exact="1ms" comment="Make sure Tutorial1_SelectShip_EmbarkObjective has a listener by the time we signal it'"/>
          <actions>
            <debug_text text="'Scenario1_SelectShip signalled'" />
            <debug_text text="'Signalling Tutorial1_SelectShip_EmbarkObjective'" />
            <signal_cue cue="Tutorial1_SelectShip_EmbarkObjective"/>
          </actions>
          <cues>
            <cue name="Tutorial_SelectShip_Hints_Initial">
              <actions>
                <debug_text text="'Signalling Tutorial_SelectShip_Hints'" />
                <signal_cue cue="Tutorial_SelectShip_Hints"/>
              </actions>
            </cue>
            <cue name="Tutorial_SelectShip_Hints" instantiate="true">
              <conditions>
                <check_any>
                  <event_cue_signalled/>
                  <event_player_started_control/>
                  <event_object_changed_room object="player.entity"/>
                </check_any>
              </conditions>
              <delay exact="1ms" />
              <actions>
                <remove_help all="true"/>
                <debug_text text="'Tutorial_SelectShip_Hints activated'" />
              </actions>
              <cues>
                <cue name="Tutorial_ReturnToShip_HintsSub">
                  <delay exact="1s" comment="slight delay feels better"/>
                  <actions>
                    <do_if value="player.ship and not player.occupiedship and player.ship.isplayerowned" comment="player standing in his ship">
                      <show_help line="1040" timeout="false" position="1" force="true" comment="To sit down in your chair"/>
                    </do_if>
                    <do_elseif value="player.occupiedship and player.occupiedship.dock and player.ship.isplayerowned" comment="player sitting in his ship">
                      <debug_text text="'Signalling Tutorial_SelectShip_PrepUndock'" />
                      <signal_cue cue="Tutorial_SelectShip_PrepUndock" check="false"/>
                    </do_elseif>
                    <do_elseif value="player.room.isclass.dockingbay" comment="player standing in dockingbay">
                      <do_if value="not $UndockPrepTriggered?">
                        <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_undock_prep', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                        <set_value name="$UndockPrepTriggered" exact="true"/>
                      </do_if>
                    </do_elseif>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Tutorial1_SelectShip_EmbarkObjective" instantiate="true">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <cancel_cue cue="Scenario1_GoToObjectiveComplete"/>
                <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.embark" object="$PlayerFighterGroup.{1}" />
              </actions>
            </cue>

            <cue name="Tutorial_SelectShip_PrepUndock">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_undock_ready', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
              </actions>
              <cues>
                <cue name="Tutorial_SelectShip_UndockHint">
                  <conditions>
                    <event_cue_completed cue="parent"/>
                  </conditions>
                  <delay exact="1ms"/>
                  <actions>
                    <debug_text text="'Tutorial_SelectShip_UndockHint'"/>
                    <show_help line="1031" timeout="false" position="4" force="true" comment="... press $INPUT_ACTION_DOCK_ACTION$ to undock."/>
                  </actions>
                  <cues>
                    <cue name="Tutorial_SelectShip_UndockHint_Done">
                      <conditions>
                        <event_object_undocking_started group="$PlayerFighterGroup"/>
                      </conditions>
                      <actions>
                        <remove_help line="1031" comment="... press $INPUT_ACTION_DOCK_ACTION$ to undock."/>
                        <reset_cue cue="Tutorial_SelectShip_PrepUndock"/>
                        <debug_text text="'Cancelling ReputationTriggerStart'"/>
                        <cancel_cue cue="md.Notifications.ReputationTriggerStart" />
                      </actions>
                    </cue>
                  </cues>
                </cue>

                <cue name="Tutorial_SelectShip_UndockReminder">
                  <conditions>
                    <event_cue_completed cue="parent"/>
                  </conditions>
                  <delay exact="10s"/>
                  <actions>
                    <do_if value="player.controlled and player.controlled.dock">
                      <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_undock_reminder', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Tutorial_SelectShip_Elevator">
              <cues>
                <cue name="Tutorial_SelectShip_Elevator_Entered" checkinterval="0.5s">
                  <conditions>
                    <check_value value="player.room == $AlliedDestroyer.controlroom and player.entity.distanceto.[$AlliedDestroyer.controlroom, $ElevatorOffset] lt 2m"/>
                  </conditions>
                  <actions>
                    <do_if value="player.room == $AlliedDestroyer.controlroom">
                      <do_if value="player.input.controller">
                        <show_help line="3108" timeout="false" position="1" force="true" comment="Press $INPUT_STATE_INTERACTION_MENU$ to interact."/>
                      </do_if>
                      <do_else>
                        <show_help line="3106" timeout="false" position="1" force="true" comment="You interact with $INPUT_STATE_INTERACTION_MENU$ or $INPUT_STATE_MOUSECLICK$."/>
                      </do_else>
                    </do_if>
                  </actions>
                </cue>
                <cue name="Tutorial_SelectShip_ElevatorReminder">
                  <delay exact="15s"/>
                  <actions>
                    <do_if value="player.room == $AlliedDestroyer.controlroom">
                      <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_elevator_reminder', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                    </do_if>
                  </actions>
                </cue>
                <cue name="Tutorial_SelectShip_Elevator_Done" instantiate="true">
                  <conditions>
                    <event_ui_triggered screen="'TransporterMenu'"/>
                  </conditions>
                  <actions>
                    <do_if value="event.param2 == ''">
                      <remove_help line="3106" comment="You interact with $INPUT_STATE_INTERACTION_MENU$ or $INPUT_STATE_MOUSECLICK$."/>
                      <remove_help line="3108" comment="Press $INPUT_STATE_INTERACTION_MENU$ to interact."/>
                      <do_if value="player.room == $AlliedDestroyer.controlroom">
                        <substitute_text text="$TransporterHintText" source="{1012,3605}">
                          <replace string="'$NAME$'" with="$PlayerFighterGroup.{1}.name"/>
                        </substitute_text>
                        <show_help custom="$TransporterHintText" timeout="false" position="1" force="true" comment="Select your ship ($NAME$) on the left, then confirm with '$INPUT_STATE_WIDGET_SELECT$'."/>
                      </do_if>
                    </do_if>
                    <do_else>
                      <remove_help all="true"/>
                    </do_else>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Tutorial_PlayerStartedControl" instantiate="true">
              <conditions>
                <event_player_started_control/>
              </conditions>
              <actions>
                <do_if value="@$CurrentObjectiveCue">
                  <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue"/>
                  <signal_cue_instantly cue="$CurrentObjectiveCue"/>
                </do_if>
              </actions>
            </cue>

            <cue name="Tutorial_PlayerStoppedControl" instantiate="true">
              <conditions>
                <event_player_stopped_control/>
              </conditions>
              <actions>
                <debug_text text="'Signalling Tutorial1_SelectShip_EmbarkObjective'" />
                <signal_cue cue="Tutorial1_SelectShip_EmbarkObjective"/>
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- Timer cues that ensure we don't exceed the 10 minute play limit while keeping the action going -->
        <cue name="Scenario1_Demo_Timeouts" onfail="cancel">
          <conditions>
            <check_value value="@userdata.demo_timeout"/>
          </conditions>
          <cues>
            <cue name="Scenario1_Timer_destroy_enemy_miner" instantiate="true" checkinterval="100ms">
              <conditions>
                <check_value value="player.age gt @userdata.demo_timeout * 0.3min"/>
              </conditions>
              <actions>
                <do_if value="$EnemyMinerGroup.count gt 0">
                  <do_all exact="$EnemyMinerGroup.count" counter="$i">
                    <set_object_min_hull object="$EnemyMinerGroup.{$i}" min="0" comment="vulnerable again"/>
                    <do_if value="$EnemyMinerGroup.{$i}.hullpercentage gt 10">
                      <set_object_hull object="$EnemyMinerGroup.{$i}" exact="$EnemyMinerGroup.{$i}.hullpercentage - 10"/>
                    </do_if>
                    <do_else>
                      <destroy_object object="$EnemyMinerGroup.{$i}" explosion="true"/>
                    </do_else>
                  </do_all>
                </do_if>
                <do_else>
                  <cancel_cue cue="this"/>
                </do_else>
              </actions>
            </cue>

            <cue name="Scenario1_Timer_destroy_enemy_squad" instantiate="true" checkinterval="100ms">
              <conditions>
                <check_value value="player.age gt @userdata.demo_timeout * 0.6min"/>
              </conditions>
              <actions>
                <do_if value="$EnemySquadGroup.count gt 0">
                  <do_all exact="$EnemySquadGroup.count" counter="$i">
                    <set_object_min_hull object="$EnemySquadGroup.{$i}" min="0" comment="vulnerable again"/>
                    <do_if value="$EnemySquadGroup.{$i}.hullpercentage gt 10">
                      <set_object_hull object="$EnemySquadGroup.{$i}" exact="$EnemySquadGroup.{$i}.hullpercentage - 10"/>
                    </do_if>
                    <do_else>
                      <destroy_object object="$EnemySquadGroup.{$i}" explosion="true"/>
                    </do_else>
                  </do_all>
                </do_if>
                <do_else>
                  <cancel_cue cue="this"/>
                </do_else>
              </actions>
            </cue>

            <cue name="Scenario1_Timer_activate_carrier">
              <delay exact="@userdata.demo_timeout * 0.8min"/>
              <actions>
                <debug_text text="'Signalling Scenario1_ActivateAlliedCarrier'" />
                <signal_cue cue="Scenario1_ActivateAlliedCarrier" check="false"/>
                <show_notification text="'2 minutes remaining'" timeout="3s" />
              </actions>
            </cue>

            <cue name="Scenario1_Timer_1_minute_warning">
              <delay exact="@userdata.demo_timeout * 1min - 1min"/>
              <actions>
                <show_notification text="'1 minute remaining'" timeout="3s" />
                <speak actor="player.computer" line="707" comment="This demo will time out in T minus one minute"/>
              </actions>
            </cue>

            <cue name="Scenario1_Timer_destroy_enemy_destroyer" instantiate="true" checkinterval="100ms">
              <conditions>
                <check_value value="player.age gt @userdata.demo_timeout * 1min - 10s"/>
              </conditions>
              <actions>
                <do_if value="$EnemyDestroyerGroup.count gt 0">
                  <do_all exact="$EnemyDestroyerGroup.count" counter="$i">
                    <set_object_min_hull object="$EnemyDestroyerGroup.{$i}" min="0" comment="vulnerable again"/>
                    <do_if value="$EnemyDestroyerGroup.{$i}.hullpercentage gt 10">
                      <set_object_hull object="$EnemyDestroyerGroup.{$i}" exact="$EnemyDestroyerGroup.{$i}.hullpercentage - 10"/>
                    </do_if>
                    <do_else>
                      <destroy_object object="$EnemyDestroyerGroup.{$i}" explosion="true"/>
                    </do_else>
                  </do_all>
                </do_if>
                <do_else>
                  <cancel_cue cue="this"/>
                </do_else>
              </actions>
            </cue>

            <cue name="Scenario1_Timer_gameover">
              <delay exact="@userdata.demo_timeout * 1min"/>
              <actions>
                <quit_gameover/>
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- First part of the scenario: cutscene of an allied capital ship which is arriving through an accelerator, player arrives on bridge -->
        <cue name="Scenario1_Start">
          <actions>
            <!-- find an allied station that's going to be defended in the scenario - it should be a shipyard so that we can spawn an under-construction capital ship -->
            <find_station name="$AlliedStation" space="player.sector" multiple="false" canbuildclass="$AlliedCarrierMacro.class"/>
            <set_value name="$AlliedStationManager" exact="$AlliedStation.assignedcontrolentity.{controlpost.manager}"/>
            <set_entity_page entity="$AlliedStationManager" page="if $AlliedStationManager.isfemale then 10108 else 10103"/>
            <add_units object="$AlliedStation" category="unitcategory.defence" mk="1" exact="2"/>
            <set_known object="$AlliedStation" known="true"/>
            <set_object_relation_behaviour object="$AlliedStation" disable="true"/>
            <!-- find an accelerator to start the scenario in front of -->
            <find_object name="$Gates" class="class.gate" accelerator="true" active="true" space="player.sector" multiple="true"/>
            <do_all exact="$Gates.count" counter="$i">
              <do_if value="not $Gate? or $Gates.{$i}.distanceto.{$AlliedStation} lt $Gate.distanceto.{$AlliedStation}">
                <set_value name="$Gate" exact="$Gates.{$i}"/>
              </do_if>
            </do_all>
            <do_if value="not $Gate?">
              <debug_text text="'No gate found?!'"/>
            </do_if>
            <set_known object="$Gate" known="true"/>
            <!-- find dockingbay for building xl ships at shipyard -->
            <find_object_component name="$AlliedBuildModule" object="$AlliedStation" canbuildclass="$AlliedCarrierMacro.class" class="class.buildmodule"/>
            <find_object_component name="$AlliedDock" object="$AlliedBuildModule">
              <match_dock size="$AlliedCarrierMacro.docksize" free="true" storage="false" />
            </find_object_component>
            <create_mission cue="X4ep1_Gamestart_Tutorial1" type="missiontype.tutorial" name="{1021,5000}" description="{1021,5001}" difficulty="level.easy" faction="$AlliedFaction">
              <briefing>
                <objective step="1" action="objective.patrol" text="'Patrol Split space'"/>
              </briefing>
            </create_mission>
            <play_music music="'music_scenario_combat_intro'"/>
          </actions>
          <cues>
            <cue name="Scenario1_CreateAlliedDestroyer">
              <actions>
                <create_position name="$AlliedDestroyerSpawnPos" object="$Gate" space="$Gate.zone" y="-40000"/>
                <create_ship name="$AlliedDestroyer" macro="$AlliedDestroyerMacro" zone="$Gate.zone" capturable="false">
                  <owner exact="$AlliedFaction" overridenpc="true" />
                  <loadout ref="scenario_combat_arg_destroyer"/>
                  <pilot macro="$AlliedDestroyerCaptainMacro">
                    <page exact="10107"/>
                  </pilot>
                  <position value="$AlliedDestroyerSpawnPos" />
                </create_ship>
                <set_object_min_hull object="$AlliedDestroyer" exact="75" comment="indestructible, for tutorial"/>
                <set_object_relation_behaviour object="$AlliedDestroyer" disable="true"/>
                <set_known object="$AlliedDestroyer" known="true"/>
                <create_order object="$AlliedDestroyer" id="'Wait'" name="$order">
                  <param name="holdfire" value="true"/>
                  <param name="noattackresponse" value="true"/>
                </create_order>
                <!-- teleport the player to the allied destroyer and clean up the ship they spawned in -->
                <set_value name="$DummyPlayerShip" exact="player.ship"/>
                <teleport_player object="$AlliedDestroyer" instant="true" force="true"/>
                <set_value name="$AlliedDestroyerCaptain" exact="$AlliedDestroyer.pilot"/>
                <debug_text text="'Captain ' + $AlliedDestroyerCaptain.knownname + ' with voice page ' + $AlliedDestroyerCaptain.page"/>
                <!--TODO: figure out how to get rid of all this code duplication!-->
                <!--create navigation officer-->
                <!--first check if there is one already-->
                <set_value name="$AlliedDestroyerNavigation" exact="$AlliedDestroyer.controlroom.controlposition.{controlposition.navigation}.entity"/>
                <do_if value="$AlliedDestroyerNavigation">
                  <debug_text text="'Removing previous navigation officer ' + $AlliedDestroyerNavigation.knownname"/>
                  <clear_actor_roomslot actor="$AlliedDestroyerNavigation"/>
                  <remove_actor_from_room actor="$AlliedDestroyerNavigation"/>
                  <destroy_object object="$AlliedDestroyerNavigation"/>
                </do_if>
                <create_cue_actor name="$AlliedDestroyerNavigation" cue="this" macro="$AlliedDestroyerNavigationMacro">
                  <owner exact="$AlliedFaction"/>
                  <page exact="10109"/>
                </create_cue_actor>
                <set_entity_traits entity="$AlliedDestroyerNavigation" missionactor="true"/>
                <set_entity_role entity="$AlliedDestroyerNavigation" role="entityrole.service"/>
                <set_value name="$AlliedDestroyerNavigation.$role_object" exact="$AlliedDestroyer"/>
                <add_actor_to_room actor="$AlliedDestroyerNavigation" slot="$AlliedDestroyer.controlroom.controlposition.{controlposition.navigation}.roomslot"/>
                <debug_text text="'Navigation ' + $AlliedDestroyerNavigation.knownname + ' with voice page ' + $AlliedDestroyerNavigation.page"/>
                <!--create helm officer-->
                <!--first check if there is one already-->
                <set_value name="$AlliedDestroyerHelm" exact="$AlliedDestroyer.controlroom.controlposition.{controlposition.flight}.entity"/>
                <do_if value="$AlliedDestroyerHelm">
                  <debug_text text="'Removing previous helm officer ' + $AlliedDestroyerHelm.knownname"/>
                  <clear_actor_roomslot actor="$AlliedDestroyerHelm"/>
                  <remove_actor_from_room actor="$AlliedDestroyerHelm"/>
                  <destroy_object object="$AlliedDestroyerHelm"/>
                </do_if>
                <create_cue_actor name="$AlliedDestroyerHelm" cue="this" macro="$AlliedDestroyerHelmMacro">
                  <owner exact="$AlliedFaction"/>
                  <page exact="10101"/>
                </create_cue_actor>
                <set_entity_traits entity="$AlliedDestroyerHelm" missionactor="true"/>
                <set_entity_role entity="$AlliedDestroyerHelm" role="entityrole.service"/>
                <set_value name="$AlliedDestroyerHelm.$role_object" exact="$AlliedDestroyer"/>
                <add_actor_to_room actor="$AlliedDestroyerHelm" slot="$AlliedDestroyer.controlroom.controlposition.{controlposition.flight}.roomslot"/>
                <debug_text text="'Helm ' + $AlliedDestroyerHelm.knownname + ' with voice page ' + $AlliedDestroyerHelm.page"/>
                <!--create gunnery officer-->
                <!--first check if there is one already-->
                <set_value name="$AlliedDestroyerGunner" exact="$AlliedDestroyer.controlroom.controlposition.{controlposition.gunner}.entity"/>
                <do_if value="$AlliedDestroyerGunner">
                  <debug_text text="'Removing previous gunnery officer ' + $AlliedDestroyerGunner.knownname"/>
                  <clear_actor_roomslot actor="$AlliedDestroyerGunner"/>
                  <remove_actor_from_room actor="$AlliedDestroyerGunner"/>
                  <destroy_object object="$AlliedDestroyerGunner"/>
                </do_if>
                <create_cue_actor name="$AlliedDestroyerGunner" cue="this" macro="$AlliedDestroyerGunnerMacro">
                  <owner exact="$AlliedFaction"/>
                  <page exact="10102"/>
                </create_cue_actor>
                <set_entity_traits entity="$AlliedDestroyerGunner" missionactor="true"/>
                <set_entity_role entity="$AlliedDestroyerGunner" role="entityrole.service"/>
                <set_value name="$AlliedDestroyerGunner.$role_object" exact="$AlliedDestroyer"/>
                <add_actor_to_room actor="$AlliedDestroyerGunner" slot="$AlliedDestroyer.controlroom.controlposition.{controlposition.gunner}.roomslot"/>
                <debug_text text="'Gunner ' + $AlliedDestroyerGunner.knownname + ' with voice page ' + $AlliedDestroyerGunner.page"/>
                <!--create marine-->
                <create_cue_actor name="$AlliedDestroyerMarine" cue="this" macro="$AlliedDestroyerMarineMacro">
                  <owner exact="$AlliedFaction"/>
                  <page exact="10110"/>
                </create_cue_actor>
                <set_entity_traits entity="$AlliedDestroyerMarine" missionactor="true"/>
                <set_entity_role entity="$AlliedDestroyerMarine" role="entityrole.service"/>
                <set_value name="$AlliedDestroyerMarine.$role_object" exact="$AlliedDestroyer"/>
                <find_npc_slot name="$MarineSlot" object="$AlliedDestroyer.controlroom" role="entityrole.marine"/>
                <add_actor_to_room actor="$AlliedDestroyerMarine" slot="$MarineSlot"/>
                <add_to_group groupname="$AlliedDestroyerMarineGroup" object="$AlliedDestroyerMarine"/>
                <debug_text text="'Marine ' + $AlliedDestroyerMarine.knownname + ' with voice page ' + $AlliedDestroyerMarine.page"/>
                <!--prevent crew from randomly walking around and disallow default conversations-->
                <find_object_component name="$AlliedDestroyerNPCs" object="$AlliedDestroyer" class="class.npc" multiple="true"/>
                <do_all exact="$AlliedDestroyerNPCs.count" counter="$i">
                  <set_value name="$AlliedDestroyerNPCs.{$i}.$Stay" exact="true"/>
                  <set_entity_traits entity="$AlliedDestroyerNPCs.{$i}" customhandler="true" />
                </do_all>
              </actions>
              <cues>
                <cue name="Scenario1_CleanUpDummyStartShip">
                  <delay exact="1ms"/>
                  <actions>
                    <do_if value="$DummyPlayerShip?">
                      <destroy_object object="$DummyPlayerShip"/>
                      <remove_value name="$DummyPlayerShip"/>
                    </do_if>
                  </actions>
                </cue>

                <cue name="Scenario1_LockTransporter_Doors">
                  <delay exact="1ms"/>
                  <actions>
                    <set_triggers_locked room="$AlliedDestroyer.controlroom" group="tag.transporter_01" locked="true" />
                  </actions>
                </cue>

                <cue name="Scenario1_StopCrewWalking" instantiate="true">
                  <conditions>
                    <event_entity_entered space="$AlliedDestroyer"/>
                  </conditions>
                  <actions>
                    <do_if value="event.object.isclass.npc">
                      <set_value name="event.object.$Stay" exact="true"/>
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_CreateShipyardShip">
              <actions>
                <create_ship name="$AlliedCarrier" macro="$AlliedCarrierMacro" dock="$AlliedDock" capturable="false">
                  <owner exact="$AlliedFaction" overridenpc="true" />
                  <pilot macro="$AlliedCarrierCaptainMacro" />
                  <people ref="$AlliedCrew"/>
                </create_ship>
                <do_if value="$AlliedCarrier.exists">
                  <debug_text text="'Carrier waiting in dock'"/>
                  <create_order id="'DockAndWait'" object="$AlliedCarrier" default="true">
                    <param name="destination" value="$AlliedStation" comment="stay docked (gives player a chance to leave)"/>
                  </create_order>
                  <set_object_relation_behaviour object="$AlliedCarrier" disable="true"/>
                </do_if>
                <do_else>
                  <debug_text text="'Ship wasn\'t created'"/>
                </do_else>
              </actions>
            </cue>

            <cue name="Scenario1_ExitGateCutscene">
              <delay exact="0.5s"/>
              <actions>
                <debug_text text="'starting Cutscene_gate_to_ship from Scenario1_ExitGateCutscene'"/>
                <play_cutscene key="'Cutscene_gate_to_ship'" targetmonitor="false" abortable="false">
                  <param name="target_gate" object="$Gate"/>
                  <param name="target_ship" object="$AlliedDestroyer"/>
                </play_cutscene>
              </actions>
              <cues>
                <cue name="Scenario1_ExitGateCutscene_Dialog1">
                  <delay exact="3s"/>
                  <actions>
                    <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_accelerator_entry', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Helm = $AlliedDestroyerHelm ], $debugchance = $UseCaseDebugChance ]" />
                  </actions>
                </cue>

                <cue name="Scenario1_ExitGateCutscene_Dialog2">
                  <delay exact="11s" comment="1 second after the ship appears on screen"/>
                  <actions>
                    <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_accelerator_exit', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Helm = $AlliedDestroyerHelm ], $debugchance = $UseCaseDebugChance ]" />
                  </actions>
                </cue>

                <cue name="Scenario1_WarpAlliedDestroyer">
                  <delay exact="10s"/>
                  <actions>
                    <warp object="$AlliedDestroyer" zone="$Gate.zone">
                      <position z="$AlliedDestroyer.size" object="$Gate" />
                      <orientation orientation="look_away" refobject="$Gate" comment="requires create_ship using zone='$Gate.zone' "/>
                    </warp>
                    <play_sound sound="'gate_flythrough'" object="$AlliedDestroyer" />
                    <add_effect effect="'jump_acceleratoreffect'" object="$Gate"/>
                    <get_safe_pos result="$sectorpos" sector="$Gate.sector" space="$Gate.sector" object="$Gate" z="3km" radius="$AlliedDestroyer.size" direction="quadrant.front" directionobject="$Gate" allowyaxis="false"/>
                    <debug_text text="'adding movement order to %s in %s, %sm away.'.[$sectorpos, $Gate.sector, $AlliedDestroyer.distanceto.[$Gate.sector, $sectorpos]]" chance="0"/>
                    <create_order object="$AlliedDestroyer" id="'MoveGeneric'" name="$order" immediate="true">
                      <param name="destination" value="$Gate.sector"/>
                      <param name="position" value="$sectorpos"/>
                      <param name="precise" value="true"/>
                      <param name="noboost" value="true"/>
                    </create_order>
                  </actions>
                </cue>

                <cue name="Scenario1_ExitGateCutsceneStopped">
                  <conditions>
                    <event_cutscene_stopped key="'Cutscene_gate_to_ship'"/>
                  </conditions>
                  <actions>
                    <debug_text text="'Cutscene_gate_to_ship stopped'"/>
                    <create_position name="$WaitObjectiveOffset" space="$AlliedDestroyer.controlroom" object="$AlliedDestroyerCaptain" x="-0.5m" z="-1.5m"/>
                    <create_position name="$ElevatorOffset" space="$AlliedDestroyer.controlroom" object="player.entity"/>
                  </actions>
                  <cues>
                    <cue name="Scenario1_SetGoToObjective">
                      <delay exact="1s"/>
                      <actions>
                        <set_triggers_locked room="$AlliedDestroyer.controlroom" group="tag.transporter_01" locked="false" />
                        <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.goto" object="$AlliedDestroyer.controlroom" offset="$WaitObjectiveOffset"/>
                        <show_help line="2150" duration="5s" position="1" force="true" comment="Your current objective is displayed on the MESSAGE TICKER in the left bottom."/>
                        <show_help line="2151" timeout="false" position="1" force="true" comment="The location of your objective is displayed as a yellow circle in the HUD."/>
                        <debug_text text="'Signalling Scenario1_FightSingleShip'" />
                        <signal_cue cue="Scenario1_FightSingleShip"/>
                      </actions>
                    </cue>
                    <cue name="Scenario1_GoToObjectiveComplete" checkinterval="0.5s">
                      <conditions>
                        <check_value value="player.room == $AlliedDestroyer.controlroom and player.entity.distanceto.[$AlliedDestroyer.controlroom, $WaitObjectiveOffset] lt 4m"/>
                      </conditions>
                      <actions>
                        <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.wait"/>
                        <remove_help line="2150"/>
                        <remove_help line="2151"/>
                      </actions>
                    </cue>

                    <cue name="Scenario1_MarineSalute" checkinterval="0.5s">
                      <conditions>
                        <check_value value="player.entity.distanceto.{$AlliedDestroyerCaptain} lt 19m"/>
                      </conditions>
                      <actions>
                        <start_actor_sequence actor="$AlliedDestroyerMarine" type="'marshalling_dispatch'" behavior="'generic'" transition="true" immediate="true"/>
                        <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_player_arrives_on_bridge', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Marine = $AlliedDestroyerMarine ], $debugchance = $UseCaseDebugChance ]" />
                      </actions>
                      <cues>
                        <cue name="Scenario1_StopMarineSalute">
                          <conditions>
                            <event_character_animation_started group="$AlliedDestroyerMarineGroup" id="'anim_marshal_dispatch_01'" />
                          </conditions>
                          <delay exact="1ms"/>
                          <actions>
                            <start_actor_sequence actor="event.object" type="'marshalling_standby'" behavior="'generic'" transition="true"/>
                          </actions>
                        </cue>
                      </cues>
                    </cue>

                    <cue name="GreetingHandler" instantiate="true">
                      <conditions>
                        <event_conversation_started conversation="default"/>
                        <check_value value="$AlliedDestroyerNPCs.indexof.{event.object}"/>
                      </conditions>
                      <actions>
                        <do_if value="player.entity.isfemale">
                          <add_npc_line line="3002" comment="Ma'am."/>
                        </do_if>
                        <do_else>
                          <add_npc_line line="3001" comment="Sir."/>
                        </do_else>
                      </actions>
                    </cue>
                  </cues>
                </cue>
              </cues>
            </cue>
          </cues>
        </cue>

        <!-- Second part of the scenario: get in a small ship and fight off a single Xenon attacker -->
        <cue name="Scenario1_FightSingleShip">
          <conditions>
            <event_cue_signalled/>
          </conditions>
          <delay exact="5s"/>
          <cues>
            <cue name="Scenario1_CreateEnemyMiner">
              <conditions>
                <event_cue_completed cue="Scenario1_FightSingleShip"/>
              </conditions>
              <actions>
                <!-- create enemy ship -->
                <create_position name="$EnemyMinerLocation" object="$Gate" x="-10km" y="500m" z="10km"/>
                <create_ship name="$EnemyMiner" macro="$EnemyMinerMacro" zone="$Gate.zone" capturable="false">
                  <owner exact="$EnemyFaction" overridenpc="true" />
                  <loadout>
                    <level exact="1.0"/>
                    <variation exact="0"/>
                  </loadout>
                  <pilot>
                    <select faction="$EnemyFaction" />
                  </pilot>
                  <position value="$EnemyMinerLocation" max="100m"/>
                </create_ship>
                <add_to_group groupname="$EnemyMinerGroup" object="$EnemyMiner"/>
                <set_object_min_shield object="$EnemyMiner" min="20" comment="initially invulnerable" />
                <set_object_min_hull object="$EnemyMiner" min="100" comment="initially invulnerable" />
                <debug_text text="'Setting Attack order for fighter ' + $EnemyMiner"/>
                <create_order object="$EnemyMiner" id="'Attack'">
                  <param name="primarytarget" value="$AlliedDestroyer"/>
                  <param name="pursuetargets" value="true"/>
                  <param name="allowothertargets" value="false"/>
                  <param name="allowboost" value="false"/>
                </create_order>
              </actions>
              <cues>
                <cue name="Ship_Attacked_By_Player">
                  <conditions>
                    <event_player_attacked_object attacked="$EnemyMiner" />
                  </conditions>
                  <actions>
                    <debug_text text="'Making attacked ship vulnerable'" />
                    <set_object_min_shield object="$EnemyMiner" min="0" comment="vulnerable again" />
                    <set_object_min_hull object="$EnemyMiner" min="0" comment="vulnerable again" />
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_RedAlert">
              <conditions>
                <event_cue_completed cue="Scenario1_FightSingleShip"/>
              </conditions>
              <delay exact="10s"/>
              <actions>
                <set_alert_level object="$AlliedDestroyer" level="red"/>
                <create_order object="$AlliedDestroyer" id="'Attack'" immediate="true">
                  <param name="primarytarget" value="$EnemyMiner"/>
                  <param name="pursuetargets" value="false"/>
                  <param name="allowothertargets" value="false"/>
                  <param name="allowboost" value="false"/>
                </create_order>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_miner_spotted', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                <set_value name="$CurrentObjectiveCue" exact="Scenario1_DestroyMinerObjective"/>
                <do_if value="player.occupiedship">
                  <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                  <signal_cue cue="$CurrentObjectiveCue"/>
                </do_if>
                <debug_text text="'Signalling Scenario1_RequestRetrieval'"/>
                <signal_cue cue="Scenario1_RequestRetrieval"/>
              </actions>
              <cues>
                <cue name="Scenario1_RedAlertCutscene">
                  <conditions>
                    <event_cue_completed cue="Scenario1_RedAlert"/>
                  </conditions>
                  <delay exact="0.5s"/>
                  <actions>
                    <debug_text text="'starting Cutscene_pan_behind from Scenario1_RedAlert'"/>
                    <play_cutscene result="$CutsceneID" key="'Cutscene_pan_behind'" targetmonitor="true">
                      <param name="target_object" object="$EnemyMiner"/>
                    </play_cutscene>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_DestroyMinerObjective" instantiate="true">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.destroy" object="$EnemyMiner"/>
              </actions>
            </cue>

            <cue name="Scenario1_RequestRetrieval">
              <conditions>
                <event_cue_signalled/>
                <check_value value="$AlliedDestroyer"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <debug_text text="'Scenario1_RequestRetrieval signalled'"/>
                <!-- populate the internal docks of the allied ship #1-->
                <do_if value="$PlayerFighterMacro1?">
                  <find_object_component name="$AlliedDestroyerInternalDock" object="$AlliedDestroyer">
                    <match_dock storage="true" size="$PlayerFighterMacro1.docksize"/>
                  </find_object_component>
                  <do_if value="$AlliedDestroyerInternalDock">
                    <create_ship name="$PlayerFighter1" macro="$PlayerFighterMacro1" dock="$AlliedDestroyerInternalDock" capturable="false">
                      <owner exact="faction.player" overridenpc="true" />
                      <!--Important: this loadout ref must not be used twice in this file, or the DLC patch code needs to be adjusted!-->
                      <loadout ref="scenario_combat_arg_heavyfighter" />
                      <paint ware="$PlayerFighterPaintMod"/>
                    </create_ship>
                    <add_to_group groupname="$PlayerFighterGroup" object="$PlayerFighter1"/>
                    <add_to_group groupname="$PlayerWeaponsGroup" list="$PlayerFighter1.weapons.operational.list"/>
                    <set_object_min_hull object="$PlayerFighter1" min="1"/>
                    <debug_text text="'Signalling Scenario1_RequestRetrieval_Delay1'"/>
                    <signal_cue cue="Scenario1_RequestRetrieval_Delay1"/>
                  </do_if>
                </do_if>
                <do_if value="$PlayerFighterMacro2?">
                  <!-- populate the internal docks of the allied ship #2-->
                  <find_object_component name="$AlliedDestroyerInternalDock" object="$AlliedDestroyer">
                    <match_dock storage="true" size="$PlayerFighterMacro2.docksize"/>
                  </find_object_component>
                  <do_if value="$AlliedDestroyerInternalDock">
                    <create_ship name="$PlayerFighter2" macro="$PlayerFighterMacro2" dock="$AlliedDestroyerInternalDock" capturable="false">
                      <owner exact="faction.player" overridenpc="true" />
                      <!--Important: this loadout ref must not be used twice in this file, or the DLC patch code needs to be adjusted!-->
                      <loadout ref="scenario_combat_arg_fighter"/>
                      <paint ware="$PlayerFighterPaintMod"/>
                    </create_ship>
                    <add_to_group groupname="$PlayerFighterGroup" object="$PlayerFighter2"/>
                    <add_to_group groupname="$PlayerWeaponsGroup" list="$PlayerFighter2.weapons.operational.list"/>
                    <set_object_min_hull object="$PlayerFighter2" min="1"/>
                    <debug_text text="'Signalling Scenario1_RequestRetrieval_Delay2'"/>
                    <signal_cue cue="Scenario1_RequestRetrieval_Delay2"/>
                  </do_if>
                </do_if>
              </actions>
              <cues>
                <!-- and retrieve the ships from internal storage, with a slightly delay (looks nicer) -->
                <cue name="Scenario1_RequestRetrieval_Delay1" instantiate="true">
                  <conditions>
                    <event_cue_signalled/>
                    <check_value value="$PlayerFighter1?"/>
                  </conditions>
                  <delay exact="1ms"/>
                  <actions>
                    <do_if value="$PlayerFighter1.isoperational and $PlayerFighter1.dock and $PlayerFighter1.dock.isstorage">
                      <request_retrieval queuedresult="$QueuedResult1" grantedresult="$GrantedResult1" ship="$PlayerFighter1" />
                      <debug_text text="'qr1='+$QueuedResult1 + ' gr1=' + $GrantedResult1 "/>
                    </do_if>
                  </actions>
                </cue>
                <cue name="Scenario1_RequestRetrieval_Delay2" instantiate="true">
                  <conditions>
                    <event_cue_signalled/>
                    <check_value value="$PlayerFighter2?"/>
                  </conditions>
                  <delay exact="1s"/>
                  <actions>
                    <do_if value="$PlayerFighter2.isoperational and $PlayerFighter2.dock and $PlayerFighter2.dock.isstorage">
                      <request_retrieval queuedresult="$QueuedResult2" grantedresult="$GrantedResult2" ship="$PlayerFighter2"/>
                      <debug_text text="'qr2='+$QueuedResult2 + ' gr2=' + $GrantedResult2 "/>
                      <do_if value="$QueuedResult2">
                        <debug_text text="'removing retrieval request for second ship'"/>
                        <remove_retrieval_request ship="$PlayerFighter2"/>
                      </do_if>
                    </do_if>
                  </actions>
                </cue>
                <cue name="Scenario1_RequestRetrievel_Delay3">
                  <conditions>
                    <event_cue_completed cue="Scenario1_RequestRetrieval"/>
                  </conditions>
                  <delay exact="5s"/>
                  <actions>
                    <play_music music="'music_scenario_combat_enemy_miner'"/>
                    <debug_text text="'Signalling Scenario1_SelectShip'"/>
                    <signal_cue cue="Scenario1_SelectShip"/>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_ShipDestroyed">
              <conditions>
                <event_object_destroyed group="$EnemyMinerGroup"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_miner_destroyed', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                <debug_text text="'Signalling Scenario1_FightSquad'"/>
                <signal_cue cue="Scenario1_FightSquad" />
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- Third part of the scenario: fight off a squad of Xenon fighters -->
        <cue name="Scenario1_FightSquad">
          <conditions>
            <event_cue_signalled/>
          </conditions>
          <actions></actions>
          <cues>
            <cue name="Scenario1_CreateEnemySquad">
              <actions>
                <!-- create enemy ships -->
                <create_position name="$EnemyLeaderLocation" object="$Gate" z="200m" />
                <create_orientation name="$EnemySquadRotation" orientation="look_away" refobject="$Gate" comment="requires create_ship using zone='$Gate.zone' ">
                  <position value="$EnemyLeaderLocation"/>
                </create_orientation>
                <create_ship name="$EnemyLeader" macro="$EnemySquadLeaderMacro" zone="$Gate.zone" capturable="false">
                  <owner exact="$EnemyFaction" overridenpc="true" />
                  <pilot>
                    <select faction="$EnemyFaction" />
                  </pilot>
                  <position value="$EnemyLeaderLocation"/>
                  <rotation value="$EnemySquadRotation"/>
                </create_ship>
                <get_safe_pos result="$EnemyLeaderMoveTarget" sector="$Gate.sector" space="$Gate.sector" object="$Gate" z="5km" radius="100m" direction="quadrant.front" directionobject="$Gate" allowyaxis="false"/>
                <create_order object="$EnemyLeader" id="'MoveGeneric'" immediate="true">
                  <param name="destination" value="$Gate.sector"/>
                  <param name="position" value="$EnemyLeaderMoveTarget"/>
                  <param name="precise" value="true"/>
                  <param name="disablecollisionavoidance" value="true"/>
                </create_order>
                <add_to_group groupname="$EnemySquadGroup" object="$EnemyLeader"/>
                <do_all exact="4" counter="$i">
                  <create_position name="$EnemyWingmanLocation" object="$Gate" x="if $i == 1 then 50m else if $i == 2 then -50m else 0m" y="if $i == 3 then 50m else if $i == 4 then -50m else 0m" z="150m" />
                  <create_ship name="$EnemyWingman" macro="$EnemySquadWingmanMacro" zone="$AlliedDestroyer.zone" capturable="false">
                    <owner exact="$EnemyFaction" overridenpc="true" />
                    <pilot>
                      <select faction="$EnemyFaction" />
                    </pilot>
                    <position value="$EnemyWingmanLocation"/>
                    <rotation value="$EnemySquadRotation"/>
                  </create_ship>
                  <add_to_group groupname="$EnemySquadGroup" object="$EnemyWingman"/>
                </do_all>
                <play_sound sound="'gate_flythrough'" object="$EnemyLeader" />
                <add_effect effect="'jump_acceleratoreffect'" object="$Gate"/>
              </actions>
              <cues>
                <cue name="Scenario1_EnemySquad_Formation" ref="md.LIB_Generic.Setup_ShipGroup_Formation">
                  <param name="group" value="$EnemySquadGroup"/>
                  <param name="formation" value="'xshapeback'"/>
                  <param name="formation_distance" value="50"/>
                  <param name="followerorder" value="'Escort'"/>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_IncomingSquadSpotted">
              <delay exact="1s"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_squad_spotted', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
              </actions>
            </cue>

            <cue name="Scenario1_IncomingSquadCutscene">
              <delay exact="2s"/>
              <actions>
                <debug_text text="'Starting cutscene on enemy squad at time ' + player.age" />
                <play_cutscene result="$CutsceneID" key="'Cutscene_follow_and_rotate'" targetmonitor="true">
                  <param name="target_object" object="$EnemySquadGroup.{1}"/>
                </play_cutscene>
              </actions>
            </cue>

            <cue name="Scenario1_IncomingSquadCutsceneDone">
              <conditions>
                <event_cue_completed cue="Scenario1_IncomingSquadCutscene"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <set_value name="$CurrentObjectiveCue" exact="Scenario1_IncomingSquadObjective"/>
                <do_if value="player.occupiedship.exists">
                  <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                  <signal_cue cue="$CurrentObjectiveCue"/>
                </do_if>
              </actions>
            </cue>

            <cue name="Scenario1_IncomingSquadObjective" instantiate="true">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.destroy" group="$EnemySquadGroup"/>
              </actions>
            </cue>

            <cue name="Scenario1_BoostHint">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="3s"/>
              <actions>
                <do_if value="player.input.boosttoggle">
                  <do_if value="player.input.vivecontroller">
                    <show_help line="4111" timeout="false" position="1" force="true" comment="Press the left trigger until it clicks to boost and travel longer distances in a shorter time."/>
                  </do_if>
                  <do_else>
                    <show_help line="2020" timeout="false" position="1" force="true" comment="Press $INPUT_STATE_BOOST$ to start boosting and travel longer distances in a shorter time."/>
                  </do_else>
                </do_if>
                <do_else>
                  <do_if value="player.input.vivecontroller">
                    <show_help line="4112" timeout="false" position="1" force="true" comment="Hold the left trigger until it clicks to boost and travel longer distances in a shorter time."/>
                  </do_if>
                  <do_else>
                    <show_help line="2021" timeout="false" position="1" force="true" comment="Hold $INPUT_STATE_BOOST$ to start boosting and travel longer distances in a shorter time."/>
                  </do_else>
                </do_else>
              </actions>
              <cues>
                <!--show a hint about boost drain until two seconds after boosting has stopped-->
                <cue name="Scenario1_BoostHint_BoostStarted">
                  <conditions>
                    <event_player_boost_started/>
                  </conditions>
                  <actions>
                    <remove_help line="4111"/>
                    <remove_help line="2020"/>
                    <remove_help line="4112"/>
                    <remove_help line="2021"/>
                    <show_help line="2033" timeout="false" position="1" force="true" comment="Boosting drains your shield energy."/>
                  </actions>
                </cue>
                <cue name="Scenario1_BoostHint_BoostStopped">
                  <conditions>
                    <event_player_boost_stopped/>
                  </conditions>
                  <delay exact="2s"/>
                  <actions>
                    <remove_help line="2033"/>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_ActivateEnemySquad" checkinterval="1s">
              <conditions>
                <check_any counter="$i">
                  <check_value value="$EnemySquadGroup.count ge $i and $EnemySquadGroup.{$i}.distanceto.{$AlliedDestroyer} lt 4km"/>
                  <check_value value="$EnemySquadGroup.count ge $i and $EnemySquadGroup.{$i}.distanceto.{player.ship} lt 2km"/>
                </check_any>
              </conditions>
              <actions>
                <debug_text text="'Player is close to enemy squad'" />
                <play_music music="'music_suspense'"/>
              </actions>
              <cues>
                <cue name="Scenario1_EnemiesBreakFormation">
                  <delay exact="1s"/>
                  <actions>
                    <debug_text text="'setting enemy squad orders at time ' + player.age"/>
                    <do_all exact="$EnemySquadGroup.count" counter="$i">
                      <do_if value="$EnemySquadGroup.{$i}.subordinates.count" comment="leader?">
                        <debug_text text="'Setting attack order for leader ' + $EnemySquadGroup.{$i}"/>
                        <create_order object="$EnemySquadGroup.{$i}" id="'Attack'" immediate="true">
                          <param name="primarytarget" value="$AlliedDestroyer"/>
                          <param name="pursuetargets" value="true"/>
                          <param name="allowothertargets" value="false"/>
                          <param name="allowboost" value="false"/>
                        </create_order>
                        <create_order object="$AlliedDestroyer" id="'Attack'" immediate="true">
                          <param name="primarytarget" value="$EnemySquadGroup.{$i}"/>
                          <param name="secondarytargets" value="$EnemySquadGroup.list"/>
                          <param name="pursuetargets" value="false"/>
                          <param name="allowothertargets" value="true"/>
                          <param name="allowboost" value="false"/>
                        </create_order>
                      </do_if>
                      <do_else>
                        <signal_objects object="$EnemySquadGroup.{$i}" param="if $i == 2 then player.ship else $AlliedDestroyer" param2="'break and attack'"/>
                      </do_else>
                    </do_all>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_SquadDestroyed" instantiate="true">
              <conditions>
                <event_object_destroyed group="$EnemySquadGroup"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <debug_text text="'Attacking squad member was destroyed - group size is now ' + $EnemySquadGroup.count"/>
                <do_if value="$EnemySquadGroup.count le 0">
                  <debug_text text="'Attacking squad was destroyed'"/>
                  <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_enemy_squad_destroyed', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                  <debug_text text="'Signalling Scenario1_FightDestroyer'"/>
                  <signal_cue cue="Scenario1_FightDestroyer" check="false"/>
                </do_if>
                <do_elseif value="$EnemySquadGroup.count le 2 and not $SquadAlmostDownVoicesTriggered?">
                  <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_enemy_squad_almost_destroyed', $actors = table[ $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                  <set_value name="$SquadAlmostDownVoicesTriggered" exact="true"/>
                </do_elseif>
                <do_elseif value="not $FighterDestroyedVoicesTriggered?">
                  <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_player_killed_fighter', $actors = table[ $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                  <set_value name="$FighterDestroyedVoicesTriggered" exact="true"/>
                </do_elseif>
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- Fourth part of the scenario: save an allied station from a Xenon destroyer -->
        <cue name="Scenario1_FightDestroyer">
          <conditions>
            <event_cue_signalled/>
          </conditions>
          <actions></actions>
          <cues>
            <cue name="Scenario1_CreateEnemyDestroyer">
              <actions>
                <!-- create enemy XL ship(s) -->
                <create_position name="$EnemyDestroyerLocation" object="$AlliedStation" x="-10km" z="5km"/>
                <create_orientation name="$EnemyDestroyerRotation" orientation="look_at" refobject="$AlliedStation">
                  <position value="$EnemyDestroyerLocation"/>
                </create_orientation>
                <create_ship name="$EnemyDestroyer" macro="$EnemyDestroyerMacro" zone="$AlliedStation.zone" capturable="false">
                  <owner exact="$EnemyFaction" overridenpc="true" />
                  <pilot>
                    <select faction="$EnemyFaction" />
                  </pilot>
                  <loadout ref="scenario_combat_xen_destroyer"/>
                  <position value="$EnemyDestroyerLocation"/>
                  <rotation value="$EnemyDestroyerRotation"/>
                </create_ship>
                <add_to_group groupname="$EnemyDestroyerGroup" object="$EnemyDestroyer"/>
                <do_all exact="$EnemyDestroyerGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyDestroyerGroup.{$i}" min="100" comment="initially invulnerable" />
                  <set_object_min_shield object="$EnemyDestroyerGroup.{$i}" min="80" comment="initially invulnerable" />
                  <add_to_group groupname="$EnemyTurretsGroup" list="$EnemyDestroyerGroup.{$i}.turrets.operational.list"/>
                  <do_all exact="$EnemyTurretsGroup.count" counter="$j">
                    <set_object_min_hull object="$EnemyTurretsGroup.{$j}" min="80" comment="initially invulnerable" />
                  </do_all>
                  <add_to_group groupname="$EnemyEnginesGroup" list="$EnemyDestroyerGroup.{$i}.engines.operational.list"/>
                  <create_order object="$EnemyDestroyerGroup.{$i}" id="'Attack'">
                    <param name="primarytarget" value="$AlliedStation"/>
                    <param name="pursuetargets" value="true"/>
                    <param name="allowothertargets" value="false"/>
                    <param name="allowboost" value="false"/>
                  </create_order>
                </do_all>
                <create_order object="$AlliedDestroyer" id="'MoveGeneric'" name="$order" immediate="true">
                  <param name="destination" value="$AlliedStation"/>
                  <param name="noboost" value="false"/>
                </create_order>
              </actions>
            </cue>

            <cue name="Scenario1_StationCallsForHelp">
              <delay exact="8s"/>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_station_calls_for_help', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Helm = $AlliedDestroyerHelm, $Gunner = $AlliedDestroyerGunner, $Manager = $AlliedStationManager], $debugchance = $UseCaseDebugChance ]" />
                <play_music music="'music_scenario_combat_station_distress_call'"/>
              </actions>
            </cue>
            <cue name="Scenario1_EnemyDestroyerCutscene">
              <delay exact="10s"/>
              <actions>
                <debug_text text="'Starting cutscene on enemy destroyer at time ' + player.age" />
                <play_cutscene result="$CutsceneID" key="'Cutscene_orbit_and_zoom_1'" targetmonitor="true">
                  <param name="target_object" object="$EnemyDestroyerGroup.{1}"/>
                </play_cutscene>
              </actions>
            </cue>

            <cue name="Scenario1_GoToStation">
              <conditions>
                <event_cutscene_stopped key="'Cutscene_orbit_and_zoom_1'"/>
              </conditions>
              <actions>
                <create_order object="$AlliedDestroyer" id="'Attack'" immediate="true">
                  <param name="primarytarget" value="$EnemyDestroyerGroup.{1}"/>
                  <param name="pursuetargets" value="true"/>
                  <param name="allowothertargets" value="false"/>
                  <param name="allowboost" value="true"/>
                </create_order>
              </actions>
            </cue>

            <cue name="Scenario1_TravelDriveActivated">
              <conditions>
                <event_player_travelmode_started/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <set_value name="$TravelDriveHintUnnecessary" exact="true"/>
                <remove_help line="4313" comment="To activate TRAVEL MODE, press $INPUT_ACTION_TOGGLE_TRAVEL_MODE$."/>
                <remove_help line="4314" comment="To activate TRAVEL MODE, select it via the SHIP MENU \($INPUT_ACTION_OPEN_COCKPIT_MENU$\)."/>
              </actions>
              <cues>
                <cue name="Scenario1_TravelDriveActivated_HintDelay">
                  <delay exact="0.5s"/>
                  <actions>
                    <do_if value="player.input.controller">
                      <show_help line="4309" timeout="false" log="true" position="1" force="true" comment="You can quickly leave travel mode by pressing $INPUT_STATE_FULLREVERSE$."/>
                    </do_if>
                    <do_else>
                      <show_help line="4308" timeout="false" log="true" position="1" force="true" comment="You can quickly leave travel mode by pressing $INPUT_ACTION_STOP$."/>
                    </do_else>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_TravelDriveStopped">
              <conditions>
                <event_player_travelmode_stopped/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <remove_help line="4308" comment="You can quickly leave travel mode by pressing $INPUT_ACTION_STOP$."/>
                <remove_help line="4309" comment="You can quickly leave travel mode by pressing $INPUT_STATE_FULLREVERSE$."/>
              </actions>
            </cue>

            <cue name="Scenario1_DefendStation">
              <conditions>
                <event_cutscene_stopped key="'Cutscene_orbit_and_zoom_1'"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <do_if value="not Scenario1_FightDestroyer.$SecondObjectiveSet?">
                  <debug_text text="'setting objective 8: defend station'" />
                  <set_value name="$CurrentObjectiveCue" exact="Scenario1_AttackEnemyCapshipObjective"/>
                  <do_if value="player.occupiedship.exists">
                    <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                    <signal_cue cue="$CurrentObjectiveCue"/>
                  </do_if>
                  <set_known object="$EnemyDestroyerGroup.{1}" known="true"/>
                  <do_if value="not $TravelDriveHintUnnecessary?">
                    <do_if value="player.input.controller">
                      <show_help line="4314" timeout="false" log="true" position="4" force="true" comment="To activate TRAVEL MODE, select it via the SHIP MENU \($INPUT_ACTION_OPEN_COCKPIT_MENU$\)."/>
                    </do_if>
                    <do_else>
                      <show_help line="4313" timeout="false" log="true" position="4" force="true" comment="To activate TRAVEL MODE, press $INPUT_ACTION_TOGGLE_TRAVEL_MODE$."/>
                    </do_else>
                  </do_if>
                </do_if>
              </actions>
              <cues>
                <cue name="Scenario1_DefendStation_TravelDriveReminder">
                  <conditions>
                    <event_cue_completed cue="parent"/>
                  </conditions>
                  <delay exact="10s"/>
                  <actions>
                    <do_if value="not $TravelDriveHintUnnecessary? and $AlliedStation and $AlliedStation.bboxdistanceto.{player.entity} lt 10km and not player.controlled.travel.active">
                      <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_travel_drive', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_AttackEnemyCapshipObjective" instantiate="true">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.attack" group="$EnemyDestroyerGroup"/>
              </actions>
            </cue>

            <cue name="Scenario1_AlliedDestroyerApproachesStation" checkinterval="1s">
              <conditions>
                <check_value value="not $PlayerApproachesStation_UseCase_Active? and $AlliedStation and $AlliedStation.bboxdistanceto.{$AlliedDestroyer} lt 10km"/>
              </conditions>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_destroyer_approaches_station', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                <set_value name="$AlliedDestroyerApproachesStation_UseCase_Active" exact="true"/>
              </actions>
              <cues>
                <cue name="Scenario1_AlliedDestroyerApproachesStation_UseCase_Finished" instantiate="true">
                  <conditions>
                    <event_speak_finished actor="$AlliedDestroyerCaptain" line="30401015"/>
                  </conditions>
                  <actions>
                    <remove_value name="$AlliedDestroyerApproachesStation_UseCase_Active"/>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_CreatePlayerAttackFighters">
              <delay min="5s" max="15s"/>
              <actions>
                <set_value name="$PlayerAttackerDistance" exact="20km"/>
                <debug_text text="'player.ship.position: ' + player.ship.position"/>
                <create_position name="$PlayerAttackerOrigin" object="$Gate" space="player.zone"/>
                <debug_text text="'$PlayerAttackerOrigin: ' + $PlayerAttackerOrigin"/>
                <create_orientation name="$PlayerAttackerRotation" orientation="look_at" refposition="player.ship.position">
                  <position value="$PlayerAttackerOrigin"/>
                </create_orientation>
                <debug_text text="'$PlayerAttackerRotation: ' + $PlayerAttackerRotation"/>
                <create_position name="$PlayerAttackerLocation" x="player.ship.position.x - sin($PlayerAttackerRotation.yaw) * $PlayerAttackerDistance" y="0" z="player.ship.position.z - cos($PlayerAttackerRotation.yaw) * $PlayerAttackerDistance"/>
                <debug_text text="'$PlayerAttackerLocation: ' + $PlayerAttackerLocation"/>
                <do_all exact="2">
                  <create_ship name="$PlayerAttacker" macro="$PlayerAttackerMacro" zone="player.zone" capturable="false">
                    <owner exact="$EnemyFaction" overridenpc="true" />
                    <pilot>
                      <select faction="$EnemyFaction" />
                    </pilot>
                    <position value="$PlayerAttackerLocation" max="200m"/>
                    <rotation value="$PlayerAttackerRotation"/>
                  </create_ship>
                  <create_order object="$PlayerAttacker" id="'Attack'" immediate="true">
                    <param name="primarytarget" value="player.ship"/>
                    <param name="pursuetargets" value="true"/>
                    <param name="allowothertargets" value="false"/>
                  </create_order>
                  <add_to_group groupname="$PlayerAttackerGroup" object="$PlayerAttacker"/>
                </do_all>
              </actions>
              <cues>
                <cue name="Scenario1_PlayerAttackersDestroyed" instantiate="true">
                  <conditions>
                    <event_object_destroyed group="$PlayerAttackerGroup"/>
                  </conditions>
                  <actions>
                    <debug_text text="'Player attacker was destroyed, remaining count is ' + $PlayerAttackerGroup.count"/>
                    <!--respawn player attackers until the scenario is won-->
                    <do_if value="$PlayerAttackerGroup.count le 1 and $EnemyDestroyer.exists">
                      <debug_text text="'Signalling Scenario1_CreatePlayerAttackFighters'"/>
                      <reset_cue cue="Scenario1_CreatePlayerAttackFighters"/>
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_PlayerApproachesEnemyDestroyer" checkinterval="1s">
              <conditions>
                <check_value value="$EnemyDestroyer and $EnemyDestroyer.bboxdistanceto.{player.entity} lt 5km"/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <debug_text text="'Player is close to enemy destroyer'" />
                <play_music music="'music_bigbattle'"/>
                <remove_help line="4313" comment="To activate TRAVEL MODE, press $INPUT_ACTION_TOGGLE_TRAVEL_MODE$."/>
                <remove_help line="4314" comment="To activate TRAVEL MODE, select it via the SHIP MENU \($INPUT_ACTION_OPEN_COCKPIT_MENU$\)."/>
                <do_all exact="$EnemyTurretsGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyTurretsGroup.{$i}" min="0" comment="vulnerable" />
                </do_all>
                <do_if value="$EnemyTurretsGroup.count gt 0">
                  <debug_text text="'setting objective 9: neutralize destroyer'" />
                  <set_value name="$CurrentObjectiveCue" exact="Scenario1_DestroyEnemyTurretsObjective"/>
                  <do_if value="player.occupiedship.exists">
                    <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                    <signal_cue cue="$CurrentObjectiveCue"/>
                  </do_if>
                  <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_player_approaches_station', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                  <set_value name="$PlayerApproachesStation_UseCase_Active" exact="true"/>
                  <set_value name="Scenario1_FightDestroyer.$SecondObjectiveSet" exact="true"/>
                  <debug_text text="'Signalling Scenario1_CreatePlayerAttackFighters'"/>
                  <signal_cue cue="Scenario1_CreatePlayerAttackFighters"/>
                </do_if>
              </actions>
              <cues>
                <cue name="Scenario1_DestroyEnemyTurretsObjective" instantiate="true">
                  <conditions>
                    <event_cue_signalled/>
                  </conditions>
                  <actions>
                    <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.destroy" group="$EnemyTurretsGroup" text="'Turrets'"/>
                  </actions>
                </cue>

                <cue name="Scenario1_PlayerApproachesEnemyDestroyer_UseCase_Finished" instantiate="true">
                  <conditions>
                    <event_speak_finished actor="$AlliedDestroyerCaptain" line="30401016"/>
                  </conditions>
                  <actions>
                    <remove_value name="$PlayerApproachesStation_UseCase_Active"/>
                  </actions>
                </cue>

                <cue name="Scenario1_TurretDestroyed" instantiate="true">
                  <conditions>
                    <event_object_destroyed group="$EnemyTurretsGroup"/>
                  </conditions>
                  <actions>
                    <debug_text text="'Turret was destroyed, remaining count is ' + $EnemyTurretsGroup.count"/>
                    <do_if value="$EnemyTurretsGroup.count le 1">
                      <debug_text text="'Last turret was destroyed'"/>
                      <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_turrets_destroyed', $actors = table[ $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                      <debug_text text="'Signalling Scenario1_ActivateAlliedCarrier'"/>
                      <signal_cue cue="Scenario1_ActivateAlliedCarrier" check="false"/>
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_DestroyerShieldsDown">
              <conditions>
                <check_all>
                  <event_object_shield_damaged group="$EnemyDestroyerGroup"/>
                  <check_value value="event.param2 le 0 and $EnemyDestroyerGroup.indexof.{event.param}"/>
                </check_all>
              </conditions>
              <actions>
                <debug_text text="'Enemy destroyer lost shields, new value ' + event.param2"/>
                <debug_text text="'Signalling Scenario1_ActivateAlliedCarrier'"/>
                <signal_cue cue="Scenario1_ActivateAlliedCarrier" check="false"/>
              </actions>
            </cue>

            <cue name="Scenario1_ActivateAlliedCarrier">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <create_order object="$AlliedCarrier" id="'Attack'" immediate="true">
                  <param name="primarytarget" value="$EnemyDestroyerGroup.{1}"/>
                  <param name="pursuetargets" value="true"/>
                  <param name="allowothertargets" value="false"/>
                  <param name="allowboost" value="false"/>
                </create_order>
                <debug_text text="'Signalling Scenario1_CreateAndActivateBombers'"/>
                <signal_cue cue="Scenario1_CreateAndActivateBombers"/>
              </actions>
            </cue>

            <cue name="Scenario1_CreateAndActivateBombers">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <do_if value="$AlliedBomberMacro">
                  <find_object_component name="$AlliedStationInternalDock" object="$AlliedStation">
                    <match_dock storage="true" size="$AlliedBomberMacro.docksize"/>
                  </find_object_component>
                  <do_if value="$AlliedStationInternalDock">
                    <debug_text text="'Adding bombers to carrier'"/>
                    <do_all exact="4">
                      <create_ship name="$AlliedBomber" macro="$AlliedBomberMacro" dock="$AlliedStationInternalDock" capturable="false">
                        <owner exact="$AlliedFaction" overridenpc="true" />
                        <pilot group="argon.pilot"/>
                        <!--Important: this loadout ref must not be used twice in this file, or the DLC patch code needs to be adjusted!-->
                        <loadout ref="scenario_combat_arg_bomber"/>
                      </create_ship>
                      <set_object_commander object="$AlliedBomber" commander="$AlliedCarrier"/>
                      <create_order object="$AlliedBomber" id="'Attack'" immediate="true">
                        <param name="primarytarget" value="$EnemyDestroyerGroup.{1}"/>
                        <param name="pursuetargets" value="true"/>
                        <param name="allowothertargets" value="false"/>
                        <param name="allowboost" value="false"/>
                      </create_order>
                      <set_object_relation_behaviour object="$AlliedBomber" disable="true"/>
                      <add_to_group groupname="$AlliedBomberGroup" object="$AlliedBomber"/>
                    </do_all>
                  </do_if>
                </do_if>
                <debug_text text="'Signalling Scenario1_EnemyDronesLaunch'"/>
                <signal_cue cue="Scenario1_EnemyDronesLaunch"/>
                <do_all exact="$EnemyDestroyerGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyDestroyerGroup.{$i}" min="70" comment="hull can only be damaged a little" />
                  <set_object_min_shield object="$EnemyDestroyerGroup.{$i}" min="0" comment="shields can go down now" />
                </do_all>
              </actions>
              <cues>
                <cue name="Scenario1_Bombers_Attack_UseCase">
                  <delay exact="9s"/>
                  <actions>
                    <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_bombers_attack', $actors = table[ $Pilot = $AlliedBomberGroup.{1}.pilot ], $debugchance = $UseCaseDebugChance ]" />
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_EnemyDronesLaunch">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <cues>
                <cue name="Scenario1_SpawnDronesPerBomber" instantiate="true">
                  <conditions>
                    <event_object_undocked group="$AlliedBomberGroup" comment="shortly after undocking spawn drones to attack"/>
                  </conditions>
                  <actions>
                    <find_object_component name="$EnemyDestroyerInternalDock" object="$EnemyDestroyer">
                      <match_dock storage="true" size="$DefenceDroneMacro.docksize"/>
                    </find_object_component>
                    <do_if value="$EnemyDestroyerInternalDock">
                      <!-- Teladi / SplitDLC case (launch from S-dock) -->
                      <debug_text text="'Creating enemy defence drones to attack bomber'"/>
                      <do_all exact="4" comment="4 per bomber">
                        <create_ship name="$EnemyDefenceDrone" macro="$DefenceDroneMacro" dock="$EnemyDestroyerInternalDock" capturable="false">
                          <owner exact="$EnemyDestroyer.owner" overridenpc="true" />
                          <pilot>
                            <select race="race.drone" tags="tag.aipilot"/>
                          </pilot>
                        </create_ship>
                        <set_object_commander object="$EnemyDefenceDrone" commander="$EnemyDestroyer"/>
                        <create_order object="$EnemyDefenceDrone" id="'Attack'" immediate="true">
                          <param name="primarytarget" value="event.object"/>
                          <param name="pursuetargets" value="true"/>
                          <param name="allowothertargets" value="true"/>
                          <param name="allowboost" value="false"/>
                        </create_order>
                        <add_to_group groupname="$EnemyDefenceDroneGroup" object="$EnemyDefenceDrone"/>
                      </do_all>
                    </do_if>
                    <do_else>
                      <!-- Xenon K case (no drone dock) -->
                      <debug_text text="'Creating enemy defence drones to attack bomber'"/>
                      <do_all exact="4">
                        <create_ship name="$EnemyDefenceDrone" macro="$DefenceDroneMacro" capturable="false" sector="$EnemyDestroyer.sector">
                          <owner exact="$EnemyDestroyer.owner" overridenpc="true" />
                          <pilot>
                            <select faction="$EnemyFaction" />
                          </pilot>
                          <safepos object="$EnemyDestroyer" min="350m" max="650m"/>
                        </create_ship>
                        <create_order object="$EnemyDefenceDrone" id="'Attack'" immediate="true" comment="fails if targets are docked">
                          <param name="primarytarget" value="event.object"/>
                          <param name="pursuetargets" value="true"/>
                          <param name="allowothertargets" value="true"/>
                          <param name="allowboost" value="false"/>
                        </create_order>
                        <add_to_group groupname="$EnemyDefenceDroneGroup" object="$EnemyDefenceDrone"/>
                      </do_all>
                    </do_else>
                  </actions>
                </cue>
                
                <cue name="Scenario1_EnemyDronesUsecase">
                  <delay exact="3s"/>
                  <actions>
                    <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_drones_launch', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                    <set_value name="$CurrentObjectiveCue" exact="Scenario1_AlliedBomberObjective"/>
                    <do_if value="player.occupiedship.exists">
                      <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                      <signal_cue cue="$CurrentObjectiveCue"/>
                    </do_if>
                  </actions>
                </cue>
                <cue name="Scenario1_AlliedBomberObjective" instantiate="true">
                  <conditions>
                    <event_cue_signalled/>
                  </conditions>
                  <actions>
                    <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.defend" group="$AlliedBomberGroup" text="'Allied Bombers'"/>
                  </actions>
                </cue>

                <cue name="Scenario1_EnemyDronesDestroyed" instantiate="true">
                  <conditions>
                    <event_object_destroyed group="$EnemyDefenceDroneGroup"/>
                  </conditions>
                  <actions>
                    <debug_text text="'Defence drone was destroyed, remaining count is ' + $EnemyDefenceDroneGroup.count + ' (reason: ' + event.param2 + ')'"/>
                    <do_if value="$EnemyDefenceDroneGroup.count le 1">
                      <do_if value="$EnemyEnginesGroup.count gt 0">
                        <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_drones_destroyed_attack_engines', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                        <debug_text text="'Signalling Scenario1_DestroyEnemyEngines'"/>
                        <signal_cue cue="Scenario1_DestroyEnemyEngines"/>
                      </do_if>
                      <do_elseif value="$EnemyDestroyerGroup.count gt 0">
                        <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_drones_destroyed_finish_destroyer', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                        <debug_text text="'Signalling Scenario1_FinalObjective'"/>
                        <signal_cue cue="Scenario1_FinalObjective"/>
                      </do_elseif>
                      <do_else>
                        <remove_mission cue="X4ep1_Gamestart_Tutorial1" type="completed"/>
                      </do_else>
                    </do_if>
                    <do_elseif value="event.param == player.ship">
                      <!--destroy the drone that's currently farthest away from the player-->
                      <do_all exact="$EnemyDefenceDroneGroup.count" counter="$i">
                        <do_if value="$EnemyDefenceDroneGroup.{$i}.exists and (not @$FarthestEnemyDrone or $EnemyDefenceDroneGroup.{$i}.distanceto.{player.ship} gt $FarthestEnemyDrone.distanceto.{player.ship})">
                          <set_value name="$FarthestEnemyDrone" exact="$EnemyDefenceDroneGroup.{$i}"/>
                        </do_if>
                      </do_all>
                      <do_if value="@$FarthestEnemyDrone">
                        <destroy_object object="$FarthestEnemyDrone" explosion="true"/>
                        <remove_value name="$FarthestEnemyDrone"/>
                      </do_if>
                    </do_elseif>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_DestroyEnemyEngines">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <delay exact="1ms"/>
              <actions>
                <debug_text text="'setting objective 11: take out destroyer engines'" />
                <set_value name="$CurrentObjectiveCue" exact="Scenario1_DestroyEnemyEnginesObjective"/>
                <do_if value="player.occupiedship.exists">
                  <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                  <signal_cue cue="$CurrentObjectiveCue"/>
                </do_if>
                <do_all exact="$EnemyDestroyerGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyDestroyerGroup.{$i}" min="30" comment="hull can be damaged a lot" />
                </do_all>
                <do_all exact="$EnemyEnginesGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyEnginesGroup.{$i}" min="0" comment="vulnerable" />
                </do_all>
              </actions>
              <cues>
                <cue name="Scenario1_EnemyEnginesDestroyed" instantiate="true">
                  <conditions>
                    <event_object_destroyed group="$EnemyEnginesGroup"/>
                  </conditions>
                  <actions>
                    <debug_text text="'Engine was destroyed, remaining count is ' + $EnemyEnginesGroup.count"/>
                    <do_if value="$EnemyEnginesGroup.count le 1">
                      <do_if value="$EnemyDestroyerGroup.count gt 0">
                        <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_destroyer_engines_destroyed', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                        <debug_text text="'Signalling Scenario1_FinalObjective'"/>
                        <signal_cue cue="Scenario1_FinalObjective"/>
                      </do_if>
                      <do_else>
                        <remove_mission cue="X4ep1_Gamestart_Tutorial1" type="completed"/>
                      </do_else>
                    </do_if>
                  </actions>
                </cue>

                <cue name="Scenario1_DestroyEnemyEnginesObjective" instantiate="true">
                  <conditions>
                    <event_cue_signalled/>
                  </conditions>
                  <actions>
                    <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.destroy" group="$EnemyEnginesGroup"/>
                  </actions>
                </cue>
              </cues>
            </cue>

            <cue name="Scenario1_FinalObjective">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <debug_text text="'setting objective 12: finish destroyer'" />
                <set_value name="$CurrentObjectiveCue" exact="Scenario1_FinishEnemyCapshipObjective"/>
                <do_if value="player.occupiedship.exists">
                  <debug_text text="'Signalling current objective cue ' + $CurrentObjectiveCue" />
                  <signal_cue cue="$CurrentObjectiveCue"/>
                </do_if>
                <do_all exact="$EnemyDestroyerGroup.count" counter="$i">
                  <set_object_min_hull object="$EnemyDestroyerGroup.{$i}" min="0" comment="hull can be destroyed fully" />
                </do_all>
              </actions>
            </cue>

            <cue name="Scenario1_FinishEnemyCapshipObjective" instantiate="true">
              <conditions>
                <event_cue_signalled/>
              </conditions>
              <actions>
                <set_objective cue="X4ep1_Gamestart_Tutorial1" step="1" action="objective.destroy" group="$EnemyDestroyerGroup"/>
              </actions>
            </cue>

            <cue name="Scenario1_DestroyerExplodingCutscene" instantiate="true">
              <conditions>
                <event_object_destroyed group="$EnemyDestroyerGroup"/>
              </conditions>
              <actions>
                <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_enemy_destroyer_destroyed', $actors = table[ $Captain = $AlliedDestroyerCaptain, $Gunner = $AlliedDestroyerGunner ], $debugchance = $UseCaseDebugChance ]" />
                <debug_text text="'starting Cutscene_orbit_and_zoom_2 from Scenario1_DestroyerExplodingCutscene'"/>
                <play_cutscene result="$CutsceneID" key="'Cutscene_orbit_and_zoom_2'">
                  <param name="target_object" object="event.object"/>
                </play_cutscene>
              </actions>
              <cues>
                <cue name="Scenario1_DestroyerExploded" instantiate="true">
                  <conditions>
                    <event_cutscene_stopped key="'Cutscene_orbit_and_zoom_2'"/>
                  </conditions>
                  <actions>
                    <do_if value="$EnemyDestroyerGroup.count le 0">
                      <debug_text text="'Enemy destroyer was destroyed at time ' + player.age"/>
                      <remove_mission cue="X4ep1_Gamestart_Tutorial1" type="completed"/>
                      <signal_cue_instantly cue="md.NPC_UseCases.UseCase" param="table[ $name = '$Scenario_combat_aftermath', $actors = table[ $Captain = $AlliedDestroyerCaptain ], $debugchance = $UseCaseDebugChance ]" />
                      <debug_text text="'Signalling Scenario1_GameOver'"/>
                      <signal_cue cue="Scenario1_GameOver" />
                      <play_music music="'music_scenario_combat_victory'"/>
                      <destroy_group group="$EnemyDefenceDroneGroup" explosion="true"/>
                    </do_if>
                  </actions>
                </cue>
              </cues>
            </cue>
          </cues>
        </cue>

        <cue name="Scenario1_GameOver">
          <conditions>
            <event_cue_signalled/>
          </conditions>
          <delay exact="20s"/>
          <actions>
            <quit_gameover/>
            <cancel_cue cue="Scenario1_Timer_activate_carrier"/>
            <cancel_cue cue="Scenario1_Timer_1_minute_warning"/>
            <cancel_cue cue="Scenario1_Timer_destroy_enemy_destroyer"/>
            <cancel_cue cue="Scenario1_Timer_gameover"/>
          </actions>
        </cue>

      </cues>
    </cue>
  </cues>
</mdscript>